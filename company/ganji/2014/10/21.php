<?php

$str = '{"modules":{"0.1":{"5.0.0":{"id":"0.1","title":"\u7b2c\u4e00\u5c42","icon":"","mode":"3","itemList":"42,43,44,45,46,47"}},"0.2":{"5.4.0":{"id":"0.2","title":"\u7b2c\u4e8c\u5c42","icon":"","mode":"3","itemList":"50,52,53,51,72,49,54,48"},"5.1.0":{"id":"0.2","title":"\u7b2c\u4e8c\u5c42","icon":"","mode":"3","itemList":"50,52,53,51,64,49,54,48"},"5.0.0":{"id":"0.2","title":"\u7b2c\u4e8c\u5c42","icon":"","mode":"3","itemList":"50,52,53,51,55,49,54,48"}},"0.3":{"5.8.0":{"id":"0.3","title":"\u7b2c\u4e09\u5c42","icon":"","mode":"3","itemList":"55,57,56,60,66,70,73,74,75,76,78,81"},"5.5.0":{"id":"0.3","title":"\u7b2c\u4e09\u5c42","icon":"","mode":"3","itemList":"55,57,56,60,66,68,70,73,74,75,78,81"},"5.4.0":{"id":"0.3","title":"\u7b2c\u4e09\u5c42","icon":"","mode":"3","itemList":"55,57,63,56,60,66,68,70,73,74,79,80"},"5.3.0":{"id":"0.3","title":"\u7b2c\u4e09\u5c42","icon":"","mode":"3","itemList":"55,57,63,56,60,66,68,69,70,73,79,80"},"5.2.0":{"id":"0.3","title":"\u7b2c\u4e09\u5c42","icon":"","mode":"3","itemList":"55,57,63,56,66,68,73,79,80"},"5.1.0":{"id":"0.3","title":"\u7b2c\u4e09\u5c42","icon":"","mode":"3","itemList":"55,57,63,61,56,66,73,79,80"},"5.0.0":{"id":"0.3","title":"\u7b2c\u4e09\u5c42","icon":"","mode":"3","itemList":"57,63,61,56,66,70,73,79,80"}}},"items":{"42":{"id":"0.1.1","title":"\u5168\u804c\u5de5\u4f5c","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-20\/Homepage_fulljob_icon@2x.png","jumpType":"1","dataParams":{"categoryId":"2","bgClickColor":"476fe3","bgNormalColor":"4877ff"}},"50":{"id":"0.1.11","title":"\u5ba0\u7269","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-07-08\/home_pet_ios.png","jumpType":"1","dataParams":{"categoryId":"1"}},"52":{"id":"0.1.12","title":"\u5a5a\u604b\u4ea4\u53cb","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-07-08\/home_jiaoyou_ios.png","jumpType":"9","dataParams":[]},"53":{"id":"0.1.13","title":"\u6559\u80b2\u57f9\u8bad","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-10-13\/jiaoyupeixun_icon_iOS.png","jumpType":"1","dataParams":{"categoryId":"9"}},"51":{"id":"0.1.14","title":"\u7968\u52a1","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-07-08\/home_piaowu_ios.png","jumpType":"1","dataParams":{"categoryId":"10"}},"55":{"id":"0.1.15","title":"\u642c\u5bb6","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-25\/home_banjia_icon@2x.png","jumpType":"2","dataParams":{"categoryId":"5","supportFilter":1,"filterParams":"{\"GetMajorCategoryFilter\" : {\"categoryId\":\"5\",\"majorCategoryScriptIndex\":\"2\"}}","queryParams":"{\"SearchPostsByJson2\": {\"categoryId\":\"5\",\"majorCategoryScriptIndex\":\"2\"}}","showType":0},"imgInfo":[{"imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-04-24\/banjia_ios_mini.png","startVersion":"5.1.0"}]},"57":{"id":"0.1.16","title":"\u88c5\u4fee","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-27\/zhuangxiu_icon@2x.png","jumpType":"2","dataParams":{"categoryId":"5","supportFilter":1,"filterParams":"{\"GetMajorCategoryFilter\" : {\"categoryId\":\"5\",\"majorCategoryScriptIndex\":\"23\"}}","queryParams":"{\"SearchPostsByJson2\": {\"categoryId\":\"5\",\"majorCategoryScriptIndex\":\"23\"}}","showType":0}},"58":{"id":"0.1.17","title":"\u4fdd\u6d01","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-27\/baojie_icon@2x.png","jumpType":"2","dataParams":{"categoryId":"5","supportFilter":1,"filterParams":"{\"GetMajorCategoryFilter\" : {\"categoryId\":\"5\",\"majorCategoryScriptIndex\":\"35\"}}","queryParams":"{\"SearchPostsByJson2\": {\"categoryId\":\"5\",\"majorCategoryScriptIndex\":\"35\"}}","showType":0}},"59":{"id":"0.1.18","title":"\u7ef4\u4fee","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-27\/weixiu_icon@2x.png","jumpType":"2","dataParams":{"categoryId":"5","supportFilter":1,"filterParams":"{\"GetMajorCategoryFilter\" : {\"categoryId\":\"5\",\"majorCategoryScriptIndex\":\"4\"}}","queryParams":"{\"SearchPostsByJson2\": {\"categoryId\":\"5\",\"majorCategoryScriptIndex\":\"4\"}}","showType":0}},"63":{"id":"0.1.19","title":"\u56e2\u8d2d","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-27\/tuangou_icon@2x.png","jumpType":"11","dataParams":{"wapUrl":"http:\/\/cps.dianping.com\/redirect?src=ganji_box&url=http:\/\/m.dianping.com\/tuan","distance":3000}},"43":{"id":"0.1.2","title":"\u517c\u804c\u5de5\u4f5c","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-20\/Homepage_jianzhigongzuo_icon@2x.png","jumpType":"1","dataParams":{"categoryId":"3","bgClickColor":"30ace0","bgNormalColor":"2bdffc"}},"61":{"id":"0.1.20","title":"\u67e5\u5feb\u9012","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-27\/chakuaidi_icon@2x.png","jumpType":"4","dataParams":{"wapLogin":"0","wapUrl":"http:\/\/www.kuaidi100.com\/smart\/ganji\/"}},"62":{"id":"0.1.21","title":"\u67e5\u65e5\u5386","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-27\/charili_icon@2x.png","jumpType":"4","dataParams":{"wapLogin":"0","wapUrl":"http:\/\/baidu365.duapp.com\/wannianlibaidu\/wap\/wnl.html"}},"56":{"id":"0.1.22","title":"\u62fc\u8f66","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-27\/pinche_icon@2x.png","jumpType":"2","dataParams":{"categoryId":"6","supportFilter":1,"filterParams":"{\"GetMajorCategoryFilter\" : {\"categoryId\":\"6\",\"majorCategoryScriptIndex\":\"9\"}}","queryParams":"{\"SearchPostsByJson2\": {\"categoryId\":\"6\",\"majorCategoryScriptIndex\":\"9\"}}","showType":0}},"60":{"id":"0.1.23","title":"\u624b\u673a\u53f7","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-27\/shoujihao_icon@2x.png","jumpType":"2","dataParams":null},"64":{"id":"0.1.24","title":"\u5c45\u5bb6\u5fc5\u5907","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-07-08\/home_jujiabibei_ios.png","jumpType":"15","dataParams":[]},"65":{"id":"0.1.25","title":"\u5f69\u7968","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-04-03\/home_caipiao_ios.png","jumpType":"4","dataParams":{"wapLogin":"1","wapUrl":"http:\/\/wap.ganji.com\/bj\/redirect\/?ca_name=wanzhuancaipiao_app&com_name=1395470533&ssid="}},"66":{"id":"0.1.26","title":"\u67e5\u8fdd\u7ae0","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-04-10\/3_ChaWeiZhang_iOS_ShouYe.png","jumpType":"4","dataParams":{"wapLogin":"0","wapUrl":"http:\/\/www.qiche100.cn\/function\/mobile\/home8\/index.aspx?c=48&p=119"}},"67":{"id":"0.1.27","title":"\u7535\u5f71","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-28\/iCON_dianying.png","jumpType":"11","dataParams":{"wapUrl":"http:\/\/lba.baidu.com\/ui\/dianying?ak=V3zIa8q2c5uXPuUrS6cehh0U","distance":3000}},"68":{"id":"0.1.28","title":"\u5145\u8bdd\u8d39","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-05-04\/huafei_android_icon.png","jumpType":"4","dataParams":{"wapLogin":"0","wapUrl":"https:\/\/mpos.quanminfu.com\/QmfWeb\/?channelId=100010&customizeId=1110&bizName=phoneRecharge"}},"69":{"id":"0.1.29","title":"\u7b80\u5386\u5e93","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-05-14\/Homepage_jobku_icon_ios.png","jumpType":"17","dataParams":[],"is_new":"5.3.0"},"44":{"id":"0.1.3","title":"\u751f\u6d3b\u5bb6\u653f","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-20\/Homepage_jiazhengfuwu_icon@2x.png","jumpType":"1","dataParams":{"categoryId":"5","virtualId":"1","bgClickColor":"8370e2","bgNormalColor":"8f79ff"}},"70":{"id":"0.1.30","title":"\u706b\u8f66\u7968","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-06-26\/HuoChePiao_iOS_ShouYe.png","jumpType":"4","dataParams":{"wapLogin":"0","wapUrl":"http:\/\/m.tieyou.com\/?utm_source=ganji&ad=close&top=close&buy=close&free=close"}},"71":{"id":"0.1.31","title":"\u5730\u94c1\u56fe","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-07-16\/subway_homepage_ios.png","jumpType":"20","dataParams":{"wapUrl":"http:\/\/sta.ganji.com\/ng\/app\/client\/common\/index.html#app\/client\/common\/view\/subway\/subway.js"},"is_new":"5.5.0"},"72":{"id":"0.1.32","title":"\u4eba\u624d\u7b80\u5386\u5e93","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-07-08\/home_resume_ios.png","jumpType":"17","dataParams":[],"is_new":"5.8.0"},"73":{"id":"0.1.36","title":"\u8ba2\u673a\u7968","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-08-08\/%E9%A6%96%E9%A1%B5_%E6%9C%BA%E7%A5%A8_icon@2x.png","jumpType":"4","dataParams":{"wapLogin":"0","wapUrl":"http:\/\/touch.qunar.com\/h5\/flight\/?bd_source=ganji"}},"74":{"id":"0.1.37","title":"\u4fe1\u7528\u5361","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-08-11\/%E9%A6%96%E9%A1%B5_%E4%BF%A1%E7%94%A8%E5%8D%A1_icon@2x.png","jumpType":"4","dataParams":{"wapLogin":"0","wapUrl":"http:\/\/www.51credit.com\/wap_2\/"}},"75":{"id":"0.1.38","title":"\u62bd\u5956","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-09-05\/%E6%B4%BB%E5%8A%A8-ios.png","jumpType":"20","dataParams":{"wapLogin":"1","wapUrl":"http:\/\/3g.ganji.com\/misc\/activitylist?ssid="},"is_new":"5.5.0"},"76":{"id":"0.1.39","title":"\u5145\u8bdd\u8d39","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-05-04\/huafei_android_icon.png","jumpType":"16","dataParams":[]},"45":{"id":"0.1.4","title":"\u623f\u4ea7","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-20\/Homepage_fang_icon@2x.png","jumpType":"1","dataParams":{"categoryId":"7","bgClickColor":"25b462","bgNormalColor":"20c968"}},"77":{"id":"0.1.40","title":"\u642c\u5bb6","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-04-24\/banjia_ios_mini.png","jumpType":"20","dataParams":{"wapUrl":"http:\/\/sta.ganji.com\/ng\/app\/client\/common\/index.html#app\/fuwu\/client\/banjia\/view\/customer\/index_page.js"}},"78":{"id":"0.1.41","title":"\u77ed\u79df","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-10-13\/%E8%9A%82%E8%9A%81%E7%9F%AD%E7%A7%9F-%E5%8D%95%E8%89%B2.png","jumpType":"20","dataParams":{"wapLogin":"0","wapUrl":"http:\/\/m.mayi.com\/?ca_s=tg_ganjiapp&ca_n=zs_mayi&from=ganji"}},"79":{"id":"0.1.42","title":"\u77ed\u79df","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-10-13\/%E8%9A%82%E8%9A%81%E7%9F%AD%E7%A7%9F-%E5%8D%95%E8%89%B2.png","jumpType":"4","dataParams":{"wapLogin":"0","wapUrl":"http:\/\/m.mayi.com\/?ca_s=tg_ganjiapp&ca_n=zs_mayi&from=ganji"}},"80":{"id":"0.1.43","title":"\u62bd\u5956","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-09-05\/%E6%B4%BB%E5%8A%A8-ios.png","jumpType":"4","dataParams":{"wapLogin":"1","wapUrl":"http:\/\/3g.ganji.com\/misc\/activitylist?ssid="},"is_new":"5.5.0"},"81":{"id":"0.1.44","title":"\u5f69\u7968","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-10-14\/%E9%A6%96%E9%A1%B5-%E5%BD%A9%E7%A5%A8ios.png","jumpType":"20","dataParams":{"wapLogin":"0","wapUrl":"http:\/\/cai88.com\/ent.ashx?ent=153&tid=153"}},"46":{"id":"0.1.5","title":"\u4e8c\u624b\u8f66","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-20\/Homepage_ershouche_icon@2x.png","jumpType":"1","dataParams":{"categoryId":"6","bgClickColor":"d9af09","bgNormalColor":"f4c300"}},"47":{"id":"0.1.6","title":"\u4e8c\u624b\u7269\u54c1","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-03-20\/Homepage_ershouwupin_icon@2x.png","jumpType":"1","dataParams":{"categoryId":"14","bgClickColor":"d45831","bgNormalColor":"ee5c2e"}},"49":{"id":"0.1.7","title":"\u751f\u6d3b\u7535\u8bdd\u7c3f","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-10-13\/lvxiaoer_icon_iOS.png","jumpType":"7","dataParams":[]},"54":{"id":"0.1.8","title":"\u767e\u5b9d\u7bb1","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-07-08\/home_baibaoxiang_ios.png","jumpType":"8","dataParams":[]},"48":{"id":"0.1.9","title":"\u672c\u5730\u670d\u52a1","imgUrl":"http:\/\/image.ganji.com\/mobile\/softdown\/softicon\/2014-07-08\/home_bendifuwu_ios.png","jumpType":"1","dataParams":{"categoryId":"5","virtualId":"2"}}},"version":1413875614}';
$clientVersion = '5.8.0';
$rData = json_decode($str, true);
$dataModules = $rData['modules'];
$dataItems = $rData['items'];
$modules = array();
$categoryId = 0;
foreach ($dataModules as $dataModule) {
    //寻找最接近的版本
    $versions = array_keys($dataModule);
    $fVersions = array();
    foreach ($versions as $ver) {
        $verNum = (str_replace('.', '', $ver)) * 10;
        $fVersions[$ver] = $verNum;
    }
    foreach ($fVersions as $version => $versionNum) {
        $clientVersionNum = (str_replace('.', '', $clientVersion)) * 10;
        if ($clientVersionNum >= $versionNum) {
            $modules[] = $dataModule[$version];
            break;
        }
    }
}
#item 组合
$data = array();
$indexData = $modules[0];
$indexData['itemList'] = array();
foreach ($modules as $k => $module) {
    $itemIds = explode(",", $module['itemList']);
    $modules[$k]['itemList'] = array();
    foreach ($itemIds as $itemId) {
        $modules[$k]['itemList'][] = $dataItems[$itemId];
        $indexData['itemList'][] = $dataItems[$itemId];
    }
}

if ($categoryId == 0) {
    $data['info'] = array($indexData);
} else {
    $data['info'] = $modules;
}
$data['version'] = $rData['version'];
?>
